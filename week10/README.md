---
title: "Lab 10"
author: "Audrey Omidsalar"
date: "11/5/2021"
output:
  html_document:
    toc: yes
    toc_float: yes
    keep_md: yes
  github_document:
  always_allow_html: true
---



## Setup

```r
# Initialize a temporary in memory database
con <- dbConnect(SQLite(), ":memory:")
# Download tables
actor <- read.csv("https://raw.githubusercontent.com/ivanceras/sakila/master/csv-sakila-db/actor.csv")
rental <- read.csv("https://raw.githubusercontent.com/ivanceras/sakila/master/csv-sakila-db/rental.csv")
customer <- read.csv("https://raw.githubusercontent.com/ivanceras/sakila/master/csv-sakila-db/customer.csv")
payment <- read.csv("https://raw.githubusercontent.com/ivanceras/sakila/master/csv-sakila-db/payment_p2007_01.csv")

# Copy data.frames to database
dbWriteTable(con, "actor", actor)
dbWriteTable(con, "rental", rental)
dbWriteTable(con, "customer", customer)
dbWriteTable(con, "payment", payment)
```
List tables

```r
dbListTables(con)
```

```
## [1] "actor"    "customer" "payment"  "rental"
```
#### Getting information about the *actor* table

```r
dbGetQuery(con ,"PRAGMA table_info(actor)")
```

```
##   cid        name    type notnull dflt_value pk
## 1   0    actor_id INTEGER       0         NA  0
## 2   1  first_name    TEXT       0         NA  0
## 3   2   last_name    TEXT       0         NA  0
## 4   3 last_update    TEXT       0         NA  0
```

## Exercise 1

Retrieve the actor ID, first name and last name for all actors using the actor table. Sort by last name and then by first name. Use LIMIT (head() in R) to output the top 5.


```r
dbGetQuery(con , "SELECT actor_id, first_name, last_name
FROM actor
ORDER by last_name, first_name /* comments can be added
on multiple lines like this */
LIMIT 5")
```

```
##   actor_id first_name last_name
## 1       58  CHRISTIAN    AKROYD
## 2      182     DEBBIE    AKROYD
## 3       92    KIRSTEN    AKROYD
## 4      118       CUBA     ALLEN
## 5      145        KIM     ALLEN
```

## Exercise 2


```r
dbGetQuery(con, "SELECT actor_id, first_name, last_name
FROM actor
WHERE last_name IN ('WILLIAMS', 'DAVIS')")
```

```
##   actor_id first_name last_name
## 1        4   JENNIFER     DAVIS
## 2       72       SEAN  WILLIAMS
## 3      101      SUSAN     DAVIS
## 4      110      SUSAN     DAVIS
## 5      137     MORGAN  WILLIAMS
## 6      172    GROUCHO  WILLIAMS
```

## Exercise 3


```r
dbGetQuery(con, "SELECT DISTINCT customer_id
FROM rental
WHERE date(rental_date)= '2005-07-05'
")
```

```
##    customer_id
## 1          565
## 2          242
## 3           37
## 4           60
## 5          594
## 6            8
## 7          490
## 8          476
## 9          322
## 10         298
## 11         382
## 12         138
## 13         520
## 14         536
## 15         114
## 16         111
## 17         296
## 18         586
## 19         349
## 20         397
## 21         369
## 22         421
## 23         142
## 24         169
## 25         348
## 26         553
## 27         295
```

## Exercise 4.1


```r
q <- dbSendQuery(con, "SELECT *
FROM payment
WHERE amount IN (1.99, 7.99, 9.99)")
dbFetch(q, n=10)
```

```
##    payment_id customer_id staff_id rental_id amount               payment_date
## 1       16050         269        2         7   1.99 2007-01-24 21:40:19.996577
## 2       16056         270        1       193   1.99 2007-01-26 05:10:14.996577
## 3       16081         282        2        48   1.99 2007-01-25 04:49:12.996577
## 4       16103         294        1       595   1.99 2007-01-28 12:28:20.996577
## 5       16133         307        1       614   1.99 2007-01-28 14:01:54.996577
## 6       16158         316        1      1065   1.99 2007-01-31 07:23:22.996577
## 7       16160         318        1       224   9.99 2007-01-26 08:46:53.996577
## 8       16161         319        1        15   9.99 2007-01-24 23:07:48.996577
## 9       16180         330        2       967   7.99 2007-01-30 17:40:32.996577
## 10      16206         351        1      1137   1.99 2007-01-31 17:48:40.996577
```

```r
##fetch query to get results in 10-row chunks
dbClearResult(q)
```

## Exercise 4.2


```r
dbGetQuery(con, "SELECT *
      FROM payment
      WHERE amount > 5
      LIMIT 5")
```

```
##   payment_id customer_id staff_id rental_id amount               payment_date
## 1      16052         269        2       678   6.99 2007-01-28 21:44:14.996577
## 2      16058         271        1      1096   8.99 2007-01-31 11:59:15.996577
## 3      16060         272        1       405   6.99 2007-01-27 12:01:05.996577
## 4      16061         272        1      1041   6.99 2007-01-31 04:14:49.996577
## 5      16068         274        1       394   5.99 2007-01-27 09:54:37.996577
```
How many of these records are there?

```r
dbGetQuery(con, "SELECT COUNT (*)
      FROM payment
      WHERE amount > 5
      LIMIT 5")
```

```
##   COUNT (*)
## 1       266
```

How many per staff_id?

```r
dbGetQuery(con, "SELECT staff_id, COUNT (*) as N
      FROM payment
      WHERE amount > 5
      GROUP BY staff_id
      LIMIT 5")
```

```
##   staff_id   N
## 1        1 151
## 2        2 115
```

## Exercise 4.3


```r
dbGetQuery(con, "SELECT *
      FROM payment
      WHERE amount > 5 AND amount < 8")
```

```
##     payment_id customer_id staff_id rental_id amount               payment_date
## 1        16052         269        2       678   6.99 2007-01-28 21:44:14.996577
## 2        16060         272        1       405   6.99 2007-01-27 12:01:05.996577
## 3        16061         272        1      1041   6.99 2007-01-31 04:14:49.996577
## 4        16068         274        1       394   5.99 2007-01-27 09:54:37.996577
## 5        16074         277        2       308   6.99 2007-01-26 20:30:05.996577
## 6        16082         282        2       282   6.99 2007-01-26 17:24:52.996577
## 7        16086         284        1      1145   6.99 2007-01-31 18:42:11.996577
## 8        16087         286        2        81   6.99 2007-01-25 10:43:45.996577
## 9        16092         288        2       427   6.99 2007-01-27 14:38:30.996577
## 10       16094         288        2       565   5.99 2007-01-28 07:54:57.996577
## 11       16106         296        1       511   5.99 2007-01-28 01:32:30.996577
## 12       16112         299        1       332   5.99 2007-01-27 00:55:36.996577
## 13       16118         301        2       227   5.99 2007-01-26 09:20:12.996577
## 14       16121         302        2        92   5.99 2007-01-25 14:07:12.996577
## 15       16130         306        2       672   6.99 2007-01-28 20:33:55.996577
## 16       16134         307        1       970   6.99 2007-01-30 18:18:54.996577
## 17       16136         309        2       218   6.99 2007-01-26 07:55:35.996577
## 18       16139         311        2       274   5.99 2007-01-26 15:17:17.996577
## 19       16140         311        2       544   6.99 2007-01-28 05:31:26.996577
## 20       16143         311        2      1128   6.99 2007-01-31 16:17:52.996577
## 21       16147         312        2      1079   6.99 2007-01-31 09:16:43.996577
## 22       16152         314        1        80   5.99 2007-01-25 10:40:33.996577
## 23       16159         317        1       107   6.99 2007-01-25 16:56:35.996577
## 24       16165         321        1       620   5.99 2007-01-28 14:23:11.996577
## 25       16171         323        1       878   5.99 2007-01-30 04:17:39.996577
## 26       16173         325        1       131   5.99 2007-01-25 20:11:12.996577
## 27       16174         326        1       875   6.99 2007-01-30 04:06:50.996577
## 28       16177         327        1       653   6.99 2007-01-28 18:40:46.996577
## 29       16180         330        2       967   7.99 2007-01-30 17:40:32.996577
## 30       16184         332        1      1000   6.99 2007-01-30 22:54:22.996577
## 31       16186         334        1        13   6.99 2007-01-24 22:51:21.996577
## 32       16188         337        1       374   6.99 2007-01-27 06:54:56.996577
## 33       16192         339        1       876   5.99 2007-01-30 04:09:48.996577
## 34       16196         344        2       813   5.99 2007-01-29 18:43:00.996577
## 35       16208         353        2      1103   6.99 2007-01-31 12:52:44.996577
## 36       16223         361        1       368   5.99 2007-01-27 06:10:55.996577
## 37       16227         364        1       462   5.99 2007-01-27 18:39:02.996577
## 38       16228         365        2       120   5.99 2007-01-25 18:06:13.996577
## 39       16230         366        2       911   6.99 2007-01-30 09:18:48.996577
## 40       16233         368        1        64   5.99 2007-01-25 07:49:55.996577
## 41       16234         368        1       125   5.99 2007-01-25 19:17:16.996577
## 42       16240         369        2       913   7.99 2007-01-30 09:33:24.996577
## 43       16242         371        2       286   6.99 2007-01-26 18:13:17.996577
## 44       16244         371        1       384   5.99 2007-01-27 08:46:46.996577
## 45       16275         386        1       583   7.99 2007-01-28 10:17:21.996577
## 46       16277         387        1       697   7.99 2007-01-29 00:32:30.996577
## 47       16287         391        1       317   5.99 2007-01-26 21:52:22.996577
## 48       16289         391        1       891   7.99 2007-01-30 06:11:38.996577
## 49       16294         396        2       641   5.99 2007-01-28 17:14:13.996577
## 50       16297         399        2        10   5.99 2007-01-24 22:30:47.996577
## 51       16298         399        2       694   6.99 2007-01-29 00:18:09.996577
## 52       16301         400        2       171   6.99 2007-01-26 01:42:41.996577
## 53       16303         400        2       894   5.99 2007-01-30 06:59:57.996577
## 54       16310         404        2      1081   5.99 2007-01-31 09:24:58.996577
## 55       16314         407        1       619   7.99 2007-01-28 14:20:52.996577
## 56       16316         408        2        59   5.99 2007-01-25 07:25:08.996577
## 57       16318         409        1       310   6.99 2007-01-26 21:09:33.996577
## 58       16342         425        2      1098   5.99 2007-01-31 12:20:14.996577
## 59       16344         427        2        82   6.99 2007-01-25 10:46:12.996577
## 60       16346         429        2       150   5.99 2007-01-25 22:57:05.996577
## 61       16348         429        2       601   7.99 2007-01-28 12:36:48.996577
## 62       16354         432        2       326   7.99 2007-01-26 23:38:37.996577
## 63       16355         432        1       550   5.99 2007-01-28 06:07:42.996577
## 64       16359         434        2       508   5.99 2007-01-28 01:09:16.996577
## 65       16360         435        1       757   7.99 2007-01-29 08:58:13.996577
## 66       16362         436        1        45   7.99 2007-01-25 04:28:05.996577
## 67       16364         436        1       848   5.99 2007-01-29 23:48:19.996577
## 68       16367         437        1       666   5.99 2007-01-28 20:17:17.996577
## 69       16370         438        1      1138   6.99 2007-01-31 17:58:53.996577
## 70       16377         442        2       558   6.99 2007-01-28 07:07:09.996577
## 71       16378         442        1       632   5.99 2007-01-28 16:06:16.996577
## 72       16392         449        2       325   5.99 2007-01-26 23:38:21.996577
## 73       16393         449        1       849   7.99 2007-01-29 23:51:33.996577
## 74       16401         454        1       735   7.99 2007-01-29 06:36:39.996577
## 75       16405         457        2      1024   7.99 2007-01-31 01:58:45.996577
## 76       16411         461        1       684   6.99 2007-01-28 22:41:41.996577
## 77       16420         468        2       101   6.99 2007-01-25 15:45:30.996577
## 78       16422         468        2       296   6.99 2007-01-26 19:03:45.996577
## 79       16426         469        2       506   7.99 2007-01-28 00:37:45.996577
## 80       16439         474        1       816   7.99 2007-01-29 18:55:05.996577
## 81       16446         479        1       709   7.99 2007-01-29 02:16:27.996577
## 82       16448         480        1       720   6.99 2007-01-29 03:45:56.996577
## 83       16450         481        2      1109   5.99 2007-01-31 13:40:41.996577
## 84       16454         483        2       742   6.99 2007-01-29 07:04:56.996577
## 85       16464         490        2       585   6.99 2007-01-28 10:19:11.996577
## 86       16469         493        1       543   7.99 2007-01-28 05:12:00.996577
## 87       16475         497        1      1100   7.99 2007-01-31 12:31:47.996577
## 88       16490         503        1       353   5.99 2007-01-27 04:32:05.996577
## 89       16493         504        2       136   5.99 2007-01-25 20:30:56.996577
## 90       16512         510        1       372   5.99 2007-01-27 06:42:24.996577
## 91       16519         515        2       292   6.99 2007-01-26 18:50:38.996577
## 92       16525         520        1       962   6.99 2007-01-30 17:13:43.996577
## 93       16526         522        2       426   5.99 2007-01-27 14:25:23.996577
## 94       16531         525        1       437   5.99 2007-01-27 16:15:48.996577
## 95       16537         528        1       533   5.99 2007-01-28 04:43:12.996577
## 96       16539         528        2       793   5.99 2007-01-29 15:12:34.996577
## 97       16547         533        1       615   5.99 2007-01-28 14:04:18.996577
## 98       16548         534        2       304   5.99 2007-01-26 19:49:54.996577
## 99       16555         536        1       929   6.99 2007-01-30 11:01:05.996577
## 100      16561         541        1      1021   7.99 2007-01-31 01:44:41.996577
## 101      16565         543        1       243   6.99 2007-01-26 11:34:31.996577
## 102      16571         546        1       197   5.99 2007-01-26 05:27:47.996577
## 103      16572         546        1       482   6.99 2007-01-27 21:21:28.996577
## 104      16576         548        2       177   6.99 2007-01-26 02:42:55.996577
## 105      16583         550        2       922   7.99 2007-01-30 10:24:21.996577
## 106      16584         551        2       155   7.99 2007-01-25 23:43:31.996577
## 107      16594         556        2       772   5.99 2007-01-29 11:36:32.996577
## 108      16603         562        1      1139   5.99 2007-01-31 18:03:18.996577
## 109      16605         563        2       773   5.99 2007-01-29 11:46:31.996577
## 110      16606         564        2       195   5.99 2007-01-26 05:21:02.996577
## 111      16608         565        1       458   6.99 2007-01-27 18:27:02.996577
## 112      16610         566        2       234   5.99 2007-01-26 10:15:46.996577
## 113      16617         570        2      1060   7.99 2007-01-31 06:50:09.996577
## 114      16620         572        2       559   7.99 2007-01-28 07:07:28.996577
## 115      16630         577        2       291   5.99 2007-01-26 18:49:13.996577
## 116      16654         594        1      1045   6.99 2007-01-31 04:57:27.996577
## 117      16655         595        1       613   6.99 2007-01-28 13:55:48.996577
## 118      16661         596        1       974   6.99 2007-01-30 18:57:08.996577
## 119      16673         207        2       826   6.99 2007-01-29 20:24:41.996577
## 120      16683           5        1      1085   6.99 2007-01-31 09:44:09.996577
## 121      16688           7        2        46   5.99 2007-01-25 04:32:34.996577
## 122      16692           7        1      1063   5.99 2007-01-31 07:12:55.996577
## 123      16693           8        2       866   6.99 2007-01-30 02:12:20.996577
## 124      16698          11        1       987   6.99 2007-01-30 21:27:38.996577
## 125      16703          14        1       525   5.99 2007-01-28 02:53:59.996577
## 126      16718          19        1       179   6.99 2007-01-26 02:54:32.996577
## 127      16723          20        2       497   6.99 2007-01-27 23:23:05.996577
## 128      16734          24        2      1007   6.99 2007-01-30 23:30:54.996577
## 129      16736          25        1        90   7.99 2007-01-25 12:59:51.996577
## 130      16749          35        1       424   6.99 2007-01-27 14:02:27.996577
## 131      16755          42        1       635   5.99 2007-01-28 16:15:23.996577
## 132      16769          47        1       300   6.99 2007-01-26 19:25:26.996577
## 133      16789          53        2       783   5.99 2007-01-29 13:09:44.996577
## 134      16799          56        1       341   5.99 2007-01-27 02:30:08.996577
## 135      16801          56        1       569   6.99 2007-01-28 08:41:07.996577
## 136      16805          58        2       276   7.99 2007-01-26 15:44:33.996577
## 137      16809          59        1      1154   5.99 2007-01-31 20:10:35.996577
## 138      16834          74        2      1121   6.99 2007-01-31 15:06:02.996577
## 139      16843          77        1       760   5.99 2007-01-29 09:35:51.996577
## 140      16854          84        1       739   6.99 2007-01-29 06:56:44.996577
## 141      16864          89        1       740   5.99 2007-01-29 06:59:02.996577
## 142      16865          91        2       216   5.99 2007-01-26 07:46:09.996577
## 143      16866          92        1       271   5.99 2007-01-26 14:50:27.996577
## 144      16869          93        2       420   6.99 2007-01-27 13:48:04.996577
## 145      16881         103        1       240   7.99 2007-01-26 11:08:49.996577
## 146      16886         105        2       473   7.99 2007-01-27 20:05:00.996577
## 147      16888         105        1       779   6.99 2007-01-29 12:45:43.996577
## 148      16891         107        1       170   5.99 2007-01-26 01:39:38.996577
## 149      16892         107        1      1026   5.99 2007-01-31 02:13:52.996577
## 150      16895         109        1       203   5.99 2007-01-26 05:56:23.996577
## 151      16899         109        1      1061   7.99 2007-01-31 06:56:24.996577
## 152      16902         110        1       515   7.99 2007-01-28 01:38:36.996577
## 153      16918         118        2       351   5.99 2007-01-27 04:07:29.996577
## 154      16920         119        1       235   5.99 2007-01-26 10:19:35.996577
## 155      16921         119        2       540   6.99 2007-01-28 05:08:51.996577
## 156      16922         120        2        68   7.99 2007-01-25 08:15:57.996577
## 157      16931         124        2      1130   5.99 2007-01-31 16:42:23.996577
## 158      16938         128        2       888   5.99 2007-01-30 05:41:40.996577
## 159      16944         131        2       944   7.99 2007-01-30 13:54:50.996577
## 160      16945         133        1       275   6.99 2007-01-26 15:38:19.996577
## 161      16949         134        1       814   6.99 2007-01-29 18:44:38.996577
## 162      16951         135        1        78   5.99 2007-01-25 10:03:44.996577
## 163      16966         146        2       762   7.99 2007-01-29 09:44:17.996577
## 164      16976         151        2       418   5.99 2007-01-27 13:41:43.996577
## 165      16979         154        1       469   5.99 2007-01-27 19:42:52.996577
## 166      16980         154        2       865   7.99 2007-01-30 02:08:10.996577
## 167      16981         154        2       978   5.99 2007-01-30 19:59:18.996577
## 168      16983         156        2       899   6.99 2007-01-30 07:57:56.996577
## 169      16988         158        1       293   5.99 2007-01-26 18:55:28.996577
## 170      16995         161        1       520   5.99 2007-01-28 01:56:03.996577
## 171      17013         170        1       377   5.99 2007-01-27 07:32:31.996577
## 172      17017         172        1       685   6.99 2007-01-28 22:46:17.996577
## 173      17021         174        1        41   5.99 2007-01-25 03:40:55.996577
## 174      17024         176        2       380   6.99 2007-01-27 08:03:05.996577
## 175      17027         176        1      1062   7.99 2007-01-31 07:06:46.996577
## 176      17029         179        1       759   6.99 2007-01-29 09:26:23.996577
## 177      17032         181        2       579   6.99 2007-01-28 09:47:49.996577
## 178      17044         187        1       252   7.99 2007-01-26 13:08:19.996577
## 179      17045         189        2      1117   5.99 2007-01-31 14:43:57.996577
## 180      17054         194        2       677   7.99 2007-01-28 21:28:34.996577
## 181      17056         196        2       178   5.99 2007-01-26 02:50:12.996577
## 182      17072         199        1       499   7.99 2007-01-27 23:33:33.996577
## 183      17075         201        1       670   6.99 2007-01-28 20:32:29.996577
## 184      17076         201        2       756   5.99 2007-01-29 08:57:11.996577
## 185      17097         222        1         5   6.99 2007-01-24 21:33:47.996577
## 186      17111         231        1       329   5.99 2007-01-27 00:25:40.996577
## 187      17112         231        1       479   6.99 2007-01-27 21:07:36.996577
## 188      17129         239        1       636   6.99 2007-01-28 16:16:24.996577
## 189      17130         239        1      1022   7.99 2007-01-31 01:45:11.996577
## 190      17131         239        2      1082   5.99 2007-01-31 09:30:27.996577
## 191      17135         241        1       627   7.99 2007-01-28 15:33:09.996577
## 192      17145         245        1       519   7.99 2007-01-28 01:50:59.996577
## 193      17149         246        1       124   6.99 2007-01-25 19:14:37.996577
## 194      17151         246        2       434   5.99 2007-01-27 15:22:53.996577
## 195      17156         247        1       450   6.99 2007-01-27 17:47:20.996577
## 196      17157         248        2       330   7.99 2007-01-27 00:43:56.996577
## 197      17161         249        1       438   6.99 2007-01-27 16:21:00.996577
## 198      17163         250        1        61   5.99 2007-01-25 07:30:23.996577
## 199      17176         253        1       566   6.99 2007-01-28 08:20:05.996577
## 200      17180         254        1      1108   5.99 2007-01-31 13:33:38.996577
## 201      17189         259        2       722   6.99 2007-01-29 03:58:57.996577
## 202      17191         259        1      1147   5.99 2007-01-31 19:06:18.996577
## 203      17195         261        2       542   6.99 2007-01-28 05:10:39.996577
## 204      17203         267        2        91   6.99 2007-01-25 13:25:48.996577
```

